<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Kaltura Interactive Player</title>
    <script
      src="https://code.jquery.com/jquery-3.3.1.min.js"
      integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <!-- relevant for development only! -->
    <!-- 0.36.6 -->
    <!-- <script src="https://qa-apache-php7.dev.kaltura.com/p/6222/embedPlaykitJs/uiconf_id/15219305"></script> -->
    <!-- THIS UICONF HAS GA -->
    <!-- 0.37.3 -->
    <script src="https://qa-apache-php7.dev.kaltura.com/p/6222/embedPlaykitJs/uiconf_id/15220027"></script>
    <!-- 0.39.0 -->
    <!-- <script src="http://cdnapisec.kaltura.com/p/27017/embedPlaykitJs/uiconf_id/43642002"></script> -->
    <script src="dist/path-kaltura-player.js" type="text/javascript"></script>
    <script src="http://localhost:35729/livereload.js"></script>
    <!-- end of relevant for development only! -->
    <!-- 350 x 197 / 260 x 146 / 500 x 281 / 150 x 84 ⬇ ︎-->
    <style>
      #player {
        width: 500px;
        height: 281px;
      }
    </style>
    <h3>test.template.html</h3>
    <h4 id="projDetails"></h4>
    <div id="player"></div>
    <div
      id="logDiv"
      style="width: 450px;height: 100%;position: absolute;left:650px;top:0"
    ></div>
    <script>
      var optionalPlaylists = [
        {
          name: "links and hotspots",
          id: "1_pdnk89fb"
        },
        {
          name: "prefetch API",
          selected: true, ///////////////////////
          id: "0_vd5gg2z6"
        },
        {
          name: "a-bb-a",
          id: "1_o9h3609b"
        },
        {
          name: "3 by 4",
          id: "1_tltksr4c"
        },
        {
          name: "9 by 16",
          id: "1_st9lvajb"
        },
        {
          name: "short",
          id: "1_91tbi9q8"
        },
        {
          name: "Multi Audio",
          id: "1_q94de4ui"
        },
        {
          name: "Quality",
          id: "1_4nsj0e6n"
        },
        {
          name: "Links ",
          id: "1_sktk76eq"
        },
        {
          name: "CL1",
          id: "0_ugurmytu"
        },
        {
          name: "CL2",
          id: "0_5huki1y3"
        },
        {
          name: "Animals",
          id: "1_60y5a49y"
        },
        {
          name: "Complex",
          id: "1_51tet0hy"
        },
        {
          name: "Empty",
          id: "1_sxcxb5e2"
        },
        {
          name: "Start 2 Start",
          id: "1_guuku0l9"
        },
        {
          name: "1 to 2,3,4",
          id: "1_4sjm8veb",
        },
        {
          name: "Same-node",
          id: "1_4weuna20"
        },
        {
          name: "defaultPath",
          id: "1_r33krd2s"
        },
        {
          name: "self-loop",
          id: "1_s0d8kump"
        },
        {
          name: "split same",
          id: "1_a2m8w1pi"
        },
        {
          name: "balconette ",
          id: "0_dl86knxb",
          pid: 2413351
        },
        {
          name: "Deloitte ",
          id: "1_t9w32b41",
          pid: 2421271
        },
        {
          name: "QA BE ",
          id: "0_3ifwiywl",
          pid: 5885,
          isQA: true
        },
        {
          name: "QA BE ",
          id: "0_uvhsksyx",
          pid: 5809,
          isQA: true
        }
      ];

      var selectedItem;

      for (var j = 0; j < optionalPlaylists.length; j++) {
        if (optionalPlaylists[j].selected) {
          selectedItem = optionalPlaylists[j];
        }
      }
      var env = {};
      if (selectedItem.isQA) {
        env = {
          serviceUrl: "//qa-apache-php7.dev.kaltura.com/api_v3",
          cdnUrl: "//qa-apache-php7.dev.kaltura.com"
        };
      }
      var pid = 27017; // default

      if (selectedItem.pid) {
        pid = selectedItem.pid;
      }

      document.getElementById("projDetails").textContent =
        selectedItem.name + " - " + selectedItem.id;
      var config = {
        targetId: "player",
        playback: {
          // autoplay: false,
          preload: "auto"
        },
        provider: {
          // ks : "djJ8NTgwOXw3pr1EYEVjHHuRis2NzxYDzhyn4RnPuMmUhD4GZGmLDEf4oKfJe8xRiSx77VvInhSq8vrHNKc1cMlIitvfyRMpGBKUXNBamu4Rr2-WBGranp5gldiNWQh6l6cKXu0MP3bgj_1fbNVuZSv1t5vEK1dbJdgdSkDmiuTVc9Xhb2folNWucEQYQDSd72z8eIubs10EGzZU1HC28Yl7yofo05OpEXyfpgo_NdFA5D08hTaPmovwUakED2z7gD5AiS6H_gW0wYu95olXSNIPN0em4M4p",
          partnerId: pid,
          uiconfId: "15219991",
          env: env
        },
        rapt: {
          initialBitrate: 75e4,
          debug: true,
          bufferNextNodes: true,
          bufferTime: 6,
          showScrubber: true,
          showTimers: true,
          showSettings: true
        }
      };

      var kip = PathKalturaPlayer.setup(config);

      var allEvents = [
        "hotspot:click",
        "node:enter",
        "node:ended",
        "node:exit",
        "project:load",
        "project:ready",
        "buffer:prebuffer",
        "project:start",
      ];

      for (var i = 0; i < allEvents.length; i++) {
        kip.addListener(allEvents[i], function(event) {
          handleInteractiveEvent(event);
        });
      }

      kip.loadMedia({ playlistId: selectedItem.id });
      // logger - debug mode !
      function handleInteractiveEvent(event) {
        var oneLine = document.createElement("div");
        // mark buffering event in green
        var printStr = event.type;
        var payload = event.payload;
        oneLine.style.cssText = "color: blue";
        switch (event.type) {

          case "buffer:prebuffer":
            // payload is an array of the next items  - first element is the item we are switching to, all other are the
            // next nodes that we will load - by natural order (timeline appearance first, defaultPath later)
            // hard coded - if we are about to load street-food-main - we will push 3 other nodes before the default path
            if(payload.length && payload[0].name === "street food main"){

              // alter payload object - add more items. This must be a synchronous code
              // we can access the nodes from kip.data.nodes and filter by name, id, custom-data or entryId
              var streetFood1 = kip.data.nodes.find(node => node.name === "street food 1");
              var streetFood2 = kip.data.nodes.find(node => node.id === "8a8807ee-acdd-42ae-8e33-b85643b22ca2");
              var streetFood3 = kip.data.nodes.find(node => node.customData === "food3");
              payload.push(streetFood1 , streetFood2 ,streetFood3);
              printStr +=
                    '<span style="color: #648b24"> [' +
                    'API adding food 1-3'  +
                    "]</span>";
            }


            break;

          case "hotspot:click":
            printStr +=
              '<span style="color: #648b24"> [' +
              payload.hotspot.name +
              "]</span>";
            // If there is a custom-data value it will be in payload.hotspot.customData
            if(payload.hotspot.customData){
              switch(payload.hotspot.customData){
                case "street-food":
                  printStr += ' CLICKED STREET FOOD';
                  // jump by node name
                  kip.jump({name:'street food main'});
                    break;
                case "food1":
                  // jump by node id
                  kip.jump({id:'076fdbc8-61cd-462f-934c-ac04ba9de28c'});
                    break;
                case "food2":
                  // jump by node id
                  kip.jump({id:'8a8807ee-acdd-42ae-8e33-b85643b22ca2'});
                    break;
                case "food3":
                  // jump by node id
                  kip.jump({id:'1ca66c6a-51df-4a73-ba64-cd67210d1148'});
                    break;
                }

            }


            break;
          case "node:enter":
          console.log(">>>> node enter", payload );
            // Start node - identified by id
            if(payload.node.id === "a45ea217-d788-4994-a054-b048cbe49233"){

            }

          case "node:ended":
          case "node:exit":
            printStr +=
              '<span style="color: #24468b"> [' +
              payload.node.name +
              "]</span>";
            break;
          case "player:progress":
            printStr +=
              '<span style="color: #8b2136"> [' + payload.progress + "]</span>";
            break;
          case "browser:open":
            printStr +=
              '<span style="color: #648b24"> [' + payload.href + "]</span>";
            break;
          default:
            if (!isEmpty(payload)) {
              printStr +=
                '<span style="color: #9f4e8e"> [' +
                payload.toString() +
                "]</span>";
            }

          // this is a Rapt event
        }
        oneLine.innerHTML = printStr;
        document.getElementById("logDiv").appendChild(oneLine);
      }


      function seekKip(n) {
        kip.seek(n);
      }


      // helpers
      function isEmpty(obj) {
        for (var key in obj) {
          if (obj.hasOwnProperty(key)) return false;
        }
        return true;
      }

    </script>
    <br />
    <div>

      <button onclick="seekKip(kip.duration-3)" style="background: #f4cd98">
        Seek to -3sec
      </button>
      <button onclick="seekKip(kip.duration-7)" style="background: #f4Fd98">
        Seek to -7sec
      </button>




    </div>
  </body>
</html>
