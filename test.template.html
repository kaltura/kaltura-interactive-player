<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Kaltura Interactive Player </title>
</head>
<body>
    <script src="bundle.js" type="text/javascript"></script>
    <script src="./libs/engine.min.js" type="text/javascript"></script>
    <script src="http://cdnapisec.kaltura.com/p/27017/embedPlaykitJs/uiconf_id/42897631"></script>
    <!-- 350 x 197 / 260 x 146 / 500 x 281 / 150 x 84 ⬇ ︎-->
    <style>
        #player {
            width:500px;
            height:281px;
        }
    </style>
<div id="player"></div>
<div id="logDiv" style="width: 450px;height: 100%;position: absolute;left:650px;top:0"></div>
<script>
	var config = {
		session:{
			 ks: "ZDVmMjkxNDk3Y2JjNTAyMmJhMGM0N2QyMDI3NjZjOGViZjdiZWZiZnwyNzAxNzsyNzAxNzsxNTM5NTkzMjQyOzI7MjY1MjI7X19BRE1JTl9fMjY2ODc7KixkaXNhYmxlZW50aXRsZW1lbnQ="
		},
		targetId: 'player',
		playback:{
			autoplay:true,
			preload:"auto"
		},

		provider: {
			partnerId: 27017
		},

        rapt:{
			debug:false,
            bufferNextNodes: true,
            bufferTime: 8
        }

	};
    var kip = Kip.setup(config , KalturaPlayer , Rapt); // todo - maybe we can save kalturaPlayer param? // Itay\Oren

    kip.loadMedia({entryId: '1_51tet0hy'}); // 1_4377j2jl   // 1_51tet0hy (complex ! many edge cases )  // 1_sxcxb5e2 (empty - FS and layout )

    // for debug purposes - these are the buffering events
    var bufferingEvents = ["buffering","destroying","destroyed","doneBuffering","allBuffered","catchup","allUnbuffered"];
    var apiEvents = [
		"browser:hidden",
		"browser:open",
		"cue:forward",
		"cue:reverse",
		"hotspot:click",
		"node:enter",
		"node:ended",
		"node:exit",
		"project:load",
		"project:ready",
		"project:start",
		"project:unload",
		"player:play",
		"player:pause",
		"player:progress",
		"player:ratechange",
		"player:timeupdate",
		"player:volumechange"
	];

    var allEvents = apiEvents.concat(bufferingEvents);

    for (var i = 0 ; i< allEvents.length; i++){
		kip.addListener(allEvents[i] , function (event) {
			logDebugMsg(event);
		});
    }

	// logger - debug mode !
	function logDebugMsg(event){
		console.log(">>>>> !",event);
    	// return

        const oneLine = document.createElement("div");
        // mark buffering event in green
        var printStr = event.type;
        var payload = event.payload;
        if( bufferingEvents.some( a => a === event.type) ){
        	// this is a buffering event
            oneLine.style.cssText = "color: green";
            switch (event.type) {
                case "allBuffered":
                    printStr+='<span style="color: purple"> ['+payload+'] ✿</span> ';

                break;
                case "buffering":
                    printStr+='<span style="color: gray"> ['+payload+'] ⬇︎ </span>';
                break;
                case "doneBuffering":
                    printStr+='<span style="color: brown"> ['+payload+'] ✔︎︎</span>';
                break;
                default:
                    printStr+='<span style="color: mediumvioletred"> ['+payload+']</span>' ;

            }
        }else{
        	// this is a Rapt event
            oneLine.style.cssText = "color: blue";
        }
        oneLine.innerHTML = printStr;
        document.getElementById("logDiv").appendChild(oneLine);
    }

    var  playKip = function(){
		kip.play();
    }
    function pauseKip(){
		kip.pause();

    }
    function replayKip(){
		kip.replay();
    }
    function jumpToNodeKip(o){
		kip.jump(o);
    }
    function seekKip(n){
		kip.seek(n)
    }

</script>

<div>
<button onclick="playKip()">play</button>
<button onclick="pauseKip()">pause</button>
<button onclick="replayKip()">replay</button>
<button onclick="jumpToNodeKip({name:'22'})">JumpToNode by ref</button>
<button onclick="jumpToNodeKip({name:'22'})">JumpToNode by name</button>
<button onclick="seekKip(10)">Seek to 10</button>
<button onclick="seekKip(5)">Seek to 5</button>

</div>
</body>
</html>
